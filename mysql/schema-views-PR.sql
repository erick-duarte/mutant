CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `queue_config_vw` AS select distinct `asterisk`.`queues_config`.`extension` AS `extension` from `asterisk`.`queues_config`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_abandonadas` AS select `c1`.`calldate` AS `calldate`,`c1`.`clid` AS `clid`,`c1`.`src` AS `src`,`c1`.`dst` AS `dst`,`c1`.`dcontext` AS `dcontext`,`c1`.`channel` AS `channel`,`c1`.`dstchannel` AS `dstchannel`,`c1`.`lastapp` AS `lastapp`,`c1`.`lastdata` AS `lastdata`,(case when (min(`c1`.`calldate`) = max(`c1`.`calldate`)) then `c1`.`duration` else timestampdiff(SECOND,min(`c1`.`calldate`),max(`c1`.`calldate`)) end) AS `duration`,`c1`.`billsec` AS `billsec`,`c1`.`disposition` AS `disposition`,`c1`.`amaflags` AS `amaflags`,`c1`.`accountcode` AS `accountcode`,substring_index(`c1`.`uniqueid`,'.',1) AS `uniqueid`,`c1`.`userfield` AS `userfield`,`c1`.`recordingfile` AS `recordingfile`,`c1`.`cnum` AS `cnum`,`c1`.`cnam` AS `cnam`,`c1`.`outbound_cnum` AS `outbound_cnum`,`c1`.`outbound_cnam` AS `outbound_cnam`,`c1`.`dst_cnam` AS `dst_cnam`,`c1`.`did` AS `did`,`c1`.`tipo` AS `tipo`,`c1`.`operadora` AS `operadora`,`c1`.`AGENTEID` AS `agenteid`,'' AS `campo_adicional`,'sub_abandonadas' AS `tabela`,group_concat(distinct `c1`.`disposition` order by `c1`.`disposition` DESC separator ',') AS `valida_ligacao` from `asteriskcdrdb`.`cdr_logs` `c1` where (`c1`.`lastapp` = 'Queue') group by substring_index(`c1`.`uniqueid`,'.',1),`c1`.`dst`;



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_abandonadasDAC` AS select `Cel`.`uniqueid` AS `uniqueid`,`Cel`.`linkedid` AS `linkedid`,`Cel`.`eventdate` AS `calldate`,cast(from_unixtime(`Cel`.`uniqueid`) as datetime) AS `queuetime`,NULL AS `eventtime`,max((case when (`Cel`.`eventtype` in ('LINKEDID_END','CHAN_END')) then `Cel`.`eventtime` end)) AS `endtime`,`Cel`.`cid_num` AS `src`,NULL AS `dst`,ifnull(min((case when (`Cel`.`eventtype` = 'ANSWER') then `Cel`.`exten` end)),0) AS `queue_id`,time_to_sec(timediff(max((case when (`Cel`.`eventtype` in ('LINKEDID_END','CHAN_END')) then `Cel`.`eventtime` end)),ifnull(min((case when (`Cel`.`eventtype` = 'CHAN_START') then `Cel`.`eventtime` end)),`Cel`.`eventtime`))) AS `duration`,0 AS `billsec`,time_to_sec(timediff(max((case when (`Cel`.`eventtype` in ('LINKEDID_END','CHAN_END')) then `Cel`.`eventtime` end)),ifnull(min((case when (`Cel`.`eventtype` = 'CHAN_START') then `Cel`.`eventtime` end)),`Cel`.`eventtime`))) AS `tempo_espera`,('abandonadas' collate utf8mb4_unicode_ci) AS `tabela` from `asteriskcdrdb`.`cel_logs` `Cel` where ((1 = 1) and (`Cel`.`channame` regexp '^(SIP/TERMINACAO|SIP/TRAVAYA)') and (convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cel`.`linkedid` using utf8mb4))) group by `Cel`.`uniqueid` having ((`queue_id` regexp '^[0-9]+$') and (`queue_id` <> 0) and (count(distinct (case when (`Cel`.`eventtype` = 'BRIDGE_ENTER') then 1 end)) = 0));


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_abandonadasDACNova` AS select `abandonadas`.`uniqueid` AS `uniqueid`,`abandonadas`.`linkedid` AS `linkedid`,`abandonadas`.`calldate` AS `calldate`,`abandonadas`.`queuetime` AS `queuetime`,`abandonadas`.`eventtime` AS `eventtime`,`abandonadas`.`endtime` AS `endtime`,`abandonadas`.`src` AS `src`,`abandonadas`.`dst` AS `dst`,`abandonadas`.`queue_id` AS `queue_id`,`abandonadas`.`duration` AS `duration`,`abandonadas`.`billsec` AS `billsec`,`abandonadas`.`tempo_espera` AS `tempo_espera`,`abandonadas`.`tabela` AS `tabela` from (`SOLUTIONS`.`_abandonadasDAC` `abandonadas` join `SOLUTIONS`.`queue_config_vw` `queue` on((`queue`.`extension` = `abandonadas`.`queue_id`)));


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_atendidas` AS select `Cdr`.`uniqueid` AS `uniqueid`,`Cdr`.`linkedid` AS `linkedid`,`Cdr`.`eventdate` AS `calldate`,cast(from_unixtime(`Cel`.`uniqueid`) as datetime) AS `queuetime`,min((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_ENTER')) then `Cel`.`eventtime` end)) AS `eventtime`,max((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_EXIT')) then `Cel`.`eventtime` end)) AS `endtime`,`Cdr`.`src` AS `src`,`Cdr`.`dst` AS `dst`,max((case when ((convert(`Cel`.`cid_num` using utf8mb4) = (convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci)) and (`Cel`.`eventtype` = 'ANSWER') and (`Cel`.`context` = 'from-queue')) then `Cel`.`exten` end)) AS `queue_id`,time_to_sec(timediff(max((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_EXIT')) then `Cel`.`eventtime` end)),min((case when ((convert(`Cel`.`exten` using utf8mb4) = convert(`Cdr`.`dst` using utf8mb4)) and (`Cel`.`eventtype` = 'CHAN_START') and (`Cel`.`context` = 'from-queue')) then `Cel`.`eventtime` end)))) AS `duration`,time_to_sec(timediff(max((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_EXIT')) then `Cel`.`eventtime` end)),min((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_ENTER')) then `Cel`.`eventtime` end)))) AS `billsec`,time_to_sec(timediff(min((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_ENTER')) then `Cel`.`eventtime` end)),min((case when ((convert(`Cel`.`exten` using utf8mb4) = convert(`Cdr`.`dst` using utf8mb4)) and (`Cel`.`eventtype` = 'CHAN_START') and (`Cel`.`context` = 'from-queue')) then `Cel`.`eventtime` end)))) AS `tempo_espera`,'atendidas' AS `tabela` from (`asteriskcdrdb`.`cdr_logs` `Cdr` left join `asteriskcdrdb`.`cel_logs` `Cel` on(((`Cel`.`eventdate` = `Cdr`.`eventdate`) and (`Cel`.`linkedid` = (convert(`Cdr`.`linkedid` using utf8mb4) collate utf8mb4_unicode_ci)) and (`Cel`.`eventtype` in ('CHAN_START','ANSWER','BRIDGE_ENTER','BRIDGE_EXIT'))))) where ((1 = 1) and (`Cdr`.`lastapp` = 'Dial') and (`Cdr`.`disposition` = 'ANSWERED')) group by `Cdr`.`uniqueid` having ((`Cdr`.`dst` regexp '^[0-9]+$') and (`queue_id` <> 0));




CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_atendidas_DDAF` AS select `Cdr`.`uniqueid` AS `uniqueid`,`Cdr`.`linkedid` AS `linkedid`,`Cdr`.`eventdate` AS `calldate`,cast(from_unixtime(`Cel`.`uniqueid`) as datetime) AS `queuetime`,time_to_sec(timediff(max((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_EXIT')) then `Cel`.`eventtime` end)),min((case when ((convert(`Cel`.`exten` using utf8mb4) = convert(`Cdr`.`dst` using utf8mb4)) and (`Cel`.`eventtype` = 'CHAN_START') and (`Cel`.`context` = 'from-queue')) then `Cel`.`eventtime` end)))) AS `duration`,time_to_sec(timediff(max((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_EXIT')) then `Cel`.`eventtime` end)),min((case when ((convert(`Cel`.`uniqueid` using utf8mb4) = convert(`Cdr`.`uniqueid` using utf8mb4)) and (`Cel`.`channame` like concat('Local/',(convert(`Cdr`.`dst` using utf8mb4) collate utf8mb4_unicode_ci),'@from-queue%')) and (`Cel`.`appname` = 'Dial') and (`Cel`.`eventtype` = 'BRIDGE_ENTER')) then `Cel`.`eventtime` end)))) AS `billsec`,`Cdr`.`src` AS `src`,`Cdr`.`dst` AS `dst`,max((case when ((convert(`Cel`.`cid_num` using utf8mb4) = convert(`Cdr`.`dst` using utf8mb4)) and (`Cel`.`eventtype` = 'ANSWER') and (`Cel`.`context` = 'from-queue')) then `Cel`.`exten` end)) AS `queue_id`,'atendidas' AS `tabela` from (`asteriskcdrdb`.`cdr_logs` `Cdr` left join `asteriskcdrdb`.`cel_logs` `Cel` on(((`Cel`.`eventdate` = `Cdr`.`eventdate`) and (`Cel`.`linkedid` = (convert(`Cdr`.`linkedid` using utf8mb4) collate utf8mb4_unicode_ci)) and (`Cel`.`eventtype` in ('CHAN_START','ANSWER','BRIDGE_ENTER','BRIDGE_EXIT'))))) where ((1 = 1) and (`Cdr`.`lastapp` = 'Dial') and (`Cdr`.`disposition` = 'ANSWERED')) group by `Cdr`.`uniqueid` having ((`Cdr`.`dst` regexp '^[0-9]+$') and (`queue_id` <> 0)) order by `Cel`.`eventtime`;


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_efetuadas` AS select `Cdr`.`uniqueid` AS `uniqueid`,`Cdr`.`uniqueid` AS `linkedid`,`Cdr`.`eventdate` AS `calldate`,cast(from_unixtime(`Cdr`.`uniqueid`) as datetime) AS `queuetime`,min((case when (`Cel`.`eventtype` = 'BRIDGE_ENTER') then `Cel`.`eventtime` end)) AS `eventtime`,max((case when (`Cel`.`eventtype` = 'BRIDGE_EXIT') then `Cel`.`eventtime` end)) AS `endtime`,`Cdr`.`src` AS `src`,`Cdr`.`dst` AS `dst`,100 AS `queue_id`,time_to_sec(timediff(max((case when (`Cel`.`eventtype` = 'BRIDGE_EXIT') then `Cel`.`eventtime` end)),cast(from_unixtime(`Cdr`.`uniqueid`) as datetime))) AS `duration`,time_to_sec(timediff(max((case when (`Cel`.`eventtype` = 'BRIDGE_EXIT') then `Cel`.`eventtime` end)),min((case when (`Cel`.`eventtype` = 'BRIDGE_ENTER') then `Cel`.`eventtime` end)))) AS `billsec`,time_to_sec(timediff(min((case when (`Cel`.`eventtype` = 'BRIDGE_ENTER') then `Cel`.`eventtime` end)),cast(from_unixtime(`Cdr`.`uniqueid`) as datetime))) AS `tempo_espera`,('efetuadas' collate utf8mb4_unicode_ci) AS `tabela` from ((`asteriskcdrdb`.`cdr_logs` `Cdr` join `asterisk`.`devices` `Device` on((`Device`.`id` = (convert(`Cdr`.`src` using utf8mb4) collate utf8mb4_unicode_ci)))) join `asteriskcdrdb`.`cel_logs` `Cel` on((`Cel`.`linkedid` = (convert(`Cdr`.`uniqueid` using utf8mb4) collate utf8mb4_unicode_ci)))) where ((`Cdr`.`dcontext` like 'encaminhamento-%') and (substr(`Cdr`.`src`,1,4) <> 'DISC') and (length(`Cdr`.`src`) = length(`Device`.`id`)) and (length(`Cdr`.`dst`) > length(`Device`.`id`)) and (`Cdr`.`disposition` = 'ANSWERED')) group by `Cdr`.`uniqueid`;


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_efetuadas_DDAF` AS select `asteriskcdrdb`.`cdr_logs`.`uniqueid` AS `uniqueid`,`asteriskcdrdb`.`cdr_logs`.`uniqueid` AS `linkedid`,`asteriskcdrdb`.`cdr_logs`.`eventdate` AS `calldate`,cast(from_unixtime(`asteriskcdrdb`.`cdr_logs`.`uniqueid`) as datetime) AS `queuetime`,time_to_sec(timediff(max((case when (`asteriskcdrdb`.`cel_logs`.`eventtype` = 'BRIDGE_EXIT') then `asteriskcdrdb`.`cel_logs`.`eventtime` end)),cast(from_unixtime(`asteriskcdrdb`.`cdr_logs`.`uniqueid`) as datetime))) AS `duration`,time_to_sec(timediff(max((case when (`asteriskcdrdb`.`cel_logs`.`eventtype` = 'BRIDGE_EXIT') then `asteriskcdrdb`.`cel_logs`.`eventtime` end)),min((case when (`asteriskcdrdb`.`cel_logs`.`eventtype` = 'BRIDGE_ENTER') then `asteriskcdrdb`.`cel_logs`.`eventtime` end)))) AS `billsec`,`asteriskcdrdb`.`cdr_logs`.`dst` AS `src`,`asteriskcdrdb`.`cdr_logs`.`src` AS `dst`,0 AS `queue_id`,'efetuadas' AS `tabela` from ((`asteriskcdrdb`.`cdr_logs` join `asterisk`.`devices` `device` on((`device`.`id` = (convert(`asteriskcdrdb`.`cdr_logs`.`src` using utf8mb4) collate utf8mb4_unicode_ci)))) join `asteriskcdrdb`.`cel_logs` on((`asteriskcdrdb`.`cel_logs`.`linkedid` = (convert(`asteriskcdrdb`.`cdr_logs`.`uniqueid` using utf8mb4) collate utf8mb4_unicode_ci)))) where ((`asteriskcdrdb`.`cdr_logs`.`dcontext` like 'encaminhamento-%') and (substr(`asteriskcdrdb`.`cdr_logs`.`src`,1,4) <> 'DISC') and (length(`asteriskcdrdb`.`cdr_logs`.`src`) = length(`device`.`id`)) and (length(`asteriskcdrdb`.`cdr_logs`.`dst`) > length(`device`.`id`)) and (`asteriskcdrdb`.`cel_logs`.`eventtype` in ('BRIDGE_ENTER','BRIDGE_EXIT'))) group by `asteriskcdrdb`.`cdr_logs`.`uniqueid`;






CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_faixa_tempo_aux` AS select cast('08:00' as time) AS `tempo` union select cast('08:15' as time) AS `tempo` union select cast('08:30' as time) AS `tempo` union select cast('08:45' as time) AS `tempo` union select cast('09:00' as time) AS `tempo` union select cast('09:15' as time) AS `tempo` union select cast('09:30' as time) AS `tempo` union select cast('09:45' as time) AS `tempo` union select cast('10:00' as time) AS `tempo` union select cast('10:15' as time) AS `tempo` union select cast('10:30' as time) AS `tempo` union select cast('10:45' as time) AS `tempo` union select cast('11:00' as time) AS `tempo` union select cast('11:15' as time) AS `tempo` union select cast('11:30' as time) AS `tempo` union select cast('11:45' as time) AS `tempo` union select cast('12:00' as time) AS `tempo` union select cast('12:15' as time) AS `tempo` union select cast('12:30' as time) AS `tempo` union select cast('12:45' as time) AS `tempo` union select cast('13:00' as time) AS `tempo` union select cast('13:15' as time) AS `tempo` union select cast('13:30' as time) AS `tempo` union select cast('13:45' as time) AS `tempo` union select cast('14:00' as time) AS `tempo` union select cast('14:15' as time) AS `tempo` union select cast('14:30' as time) AS `tempo` union select cast('14:45' as time) AS `tempo` union select cast('15:00' as time) AS `tempo` union select cast('15:15' as time) AS `tempo` union select cast('15:30' as time) AS `tempo` union select cast('15:45' as time) AS `tempo` union select cast('16:00' as time) AS `tempo` union select cast('16:15' as time) AS `tempo` union select cast('16:30' as time) AS `tempo` union select cast('16:45' as time) AS `tempo` union select cast('17:00' as time) AS `tempo` union select cast('17:15' as time) AS `tempo` union select cast('17:30' as time) AS `tempo` union select cast('17:45' as time) AS `tempo` union select cast('18:00' as time) AS `tempo` union select cast('18:15' as time) AS `tempo` union select cast('18:30' as time) AS `tempo` union select cast('18:45' as time) AS `tempo` union select cast('19:00' as time) AS `tempo` union select cast('19:15' as time) AS `tempo` union select cast('19:30' as time) AS `tempo` union select cast('19:45' as time) AS `tempo` union select cast('20:00' as time) AS `tempo` union select cast('20:15' as time) AS `tempo` union select cast('20:30' as time) AS `tempo` union select cast('20:45' as time) AS `tempo` union select cast('21:00' as time) AS `tempo` union select cast('21:15' as time) AS `tempo` union select cast('21:30' as time) AS `tempo` union select cast('21:45' as time) AS `tempo` union select cast('22:00' as time) AS `tempo` union select cast('22:15' as time) AS `tempo` union select cast('22:30' as time) AS `tempo` union select cast('22:45' as time) AS `tempo` union select cast('23:00' as time) AS `tempo` union select cast('23:15' as time) AS `tempo` union select cast('23:30' as time) AS `tempo`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_rejeitadas` AS select `asteriskcdrdb`.`cel_logs`.`uniqueid` AS `uniqueid`,`asteriskcdrdb`.`cel_logs`.`linkedid` AS `linkedid`,`asteriskcdrdb`.`cel_logs`.`eventdate` AS `calldate`,cast(from_unixtime(`asteriskcdrdb`.`cel_logs`.`uniqueid`) as datetime) AS `queuetime`,NULL AS `eventtime`,NULL AS `endtime`,`asteriskcdrdb`.`cel_logs`.`cid_num` AS `src`,`c1`.`dst` AS `dst`,substring_index(group_concat(distinct `Answered`.`exten` order by `Answered`.`eventtime` DESC separator ','),',',1) AS `queue_id`,0 AS `duration`,0 AS `billsec`,0 AS `tempo_espera`,('rejeitadas' collate utf8mb4_unicode_ci) AS `tabela` from ((`asteriskcdrdb`.`cel_logs` left join `asteriskcdrdb`.`cel_logs` `Answered` on(((`Answered`.`linkedid` = `asteriskcdrdb`.`cel_logs`.`linkedid`) and (`Answered`.`eventtype` = 'ANSWER') and (`Answered`.`context` in ('from-queue','ext-queues')) and (`Answered`.`appname` in ('AppQueue','Answer'))))) join `asteriskcdrdb`.`cdr_logs` `c1` on(((convert(`c1`.`uniqueid` using utf8mb4) collate utf8mb4_unicode_ci) = `asteriskcdrdb`.`cel_logs`.`uniqueid`))) where ((`asteriskcdrdb`.`cel_logs`.`context` = 'from-queue-exten-internal') and (`c1`.`disposition` = 'BUSY') and (`c1`.`dcontext` = 'from-queue-exten-internal') and (`c1`.`src` <> 'anonymous')) group by `asteriskcdrdb`.`cel_logs`.`linkedid`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_faixa_tempo` AS select `t`.`tempo` AS `tempo` from `SOLUTIONS`.`_faixa_tempo_aux` `t` where (`t`.`tempo` <= (select cast(max(`asteriskcdrdb`.`cdr_logs`.`calldate`) as time) from `asteriskcdrdb`.`cdr_logs`));


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_transbordo` AS select `asteriskcdrdb`.`cel_logs`.`uniqueid` AS `uniqueid`,`asteriskcdrdb`.`cel_logs`.`linkedid` AS `linkedid`,`asteriskcdrdb`.`cel_logs`.`eventdate` AS `calldate`,cast(from_unixtime(`asteriskcdrdb`.`cel_logs`.`uniqueid`) as datetime) AS `queuetime`,NULL AS `eventtime`,NULL AS `endtime`,`asteriskcdrdb`.`cel_logs`.`cid_num` AS `src`,(case when ((`Answered`.`eventtype` = 'BRIDGE_ENTER') and (`Answered`.`context` = 'from-queue')) then `Answered`.`cid_num` end) AS `dst`,if(count(distinct (case when (`asteriskcdrdb`.`cel_logs`.`exten` <> NULL) then 1 end)),'FILA',`asteriskcdrdb`.`cel_logs`.`exten`) AS `queue_id`,0 AS `duration`,0 AS `billsec`,0 AS `tempo_espera`,('transbordo' collate utf8mb4_unicode_ci) AS `tabela` from ((`asteriskcdrdb`.`cel_logs` join `asterisk`.`queues_config` `qc` on((`qc`.`extension` = `asteriskcdrdb`.`cel_logs`.`exten`))) left join `asteriskcdrdb`.`cel_logs` `Answered` on((`Answered`.`linkedid` = `asteriskcdrdb`.`cel_logs`.`linkedid`))) where ((`asteriskcdrdb`.`cel_logs`.`eventtype` = 'ANSWER') and (`asteriskcdrdb`.`cel_logs`.`context` = 'from-queue') and (`asteriskcdrdb`.`cel_logs`.`appname` = 'AppQueue') and (`asteriskcdrdb`.`cel_logs`.`eventdate` = '2022-03-03') and (not(exists(select 1 from `asteriskcdrdb`.`cel_logs` `c1` where ((`c1`.`linkedid` = `Answered`.`linkedid`) and (`c1`.`context` = 'transferencia-chamada')))))) group by `asteriskcdrdb`.`cel_logs`.`linkedid` having (count(distinct `asteriskcdrdb`.`cel_logs`.`exten`) > 1);





CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_transferencias` AS select `Cel`.`uniqueid` AS `uniqueid`,`Cel`.`linkedid` AS `linkedid`,`Cel`.`eventdate` AS `calldate`,cast(from_unixtime(`Cel`.`uniqueid`) as datetime) AS `queuetime`,NULL AS `eventtime`,NULL AS `endtime`,substring_index(group_concat(distinct (case when ((`Answered`.`eventtype` = 'BRIDGE_ENTER') and (`Answered`.`context` = 'from-queue')) then `Answered`.`cid_num` end) order by `Answered`.`eventtime` DESC separator ','),',',-(1)) AS `src`,substring_index(group_concat(distinct (case when ((`Answered`.`eventtype` = 'BRIDGE_ENTER') and (`Answered`.`context` = 'from-queue')) then `Answered`.`cid_num` end) order by `Answered`.`eventtime` ASC separator ','),',',-(1)) AS `dst`,substring_index(group_concat(distinct (case when ((`Answered`.`eventtype` = 'ANSWER') and (`Answered`.`context` = 'from-queue') and (`Answered`.`appname` = 'AppQueue')) then `Answered`.`exten` end) order by `Answered`.`eventtime` ASC separator ','),',',-(1)) AS `queue_id`,0 AS `duration`,0 AS `billsec`,0 AS `tempo_espera`,('transferencias' collate utf8mb4_unicode_ci) AS `tabela` from (`asteriskcdrdb`.`cel_logs` `Cel` left join `asteriskcdrdb`.`cel_logs` `Answered` on(((`Answered`.`linkedid` = `Cel`.`linkedid`) and (`Answered`.`eventtype` = 'ANSWER') and (`Answered`.`context` = 'from-queue') and (`Answered`.`cid_num` = substring_index(substring_index(`Cel`.`peer`,'-',1),'SIP/',-(1)))))) where (exists(select 1 from `asteriskcdrdb`.`cel_logs` `c1` where ((`c1`.`linkedid` = `Cel`.`linkedid`) and (`c1`.`context` = 'transferencia-chamada'))) and (`Cel`.`eventtype` in ('BRIDGE_ENTER','BRIDGE_EXIT')) and (`Cel`.`appname` = 'Dial')) group by `Cel`.`linkedid` having (count((`Answered`.`eventtype` = 'ASWER')) > 1);

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_subContextoChamadasPausas` AS select `_atendidas`.`uniqueid` AS `uniqueid`,`_atendidas`.`linkedid` AS `linkedid`,`_atendidas`.`calldate` AS `calldate`,`_atendidas`.`queuetime` AS `queuetime`,`_atendidas`.`eventtime` AS `eventtime`,`_atendidas`.`endtime` AS `endtime`,`_atendidas`.`src` AS `src`,`_atendidas`.`dst` AS `dst`,`_atendidas`.`queue_id` AS `queue_id`,`_atendidas`.`duration` AS `duration`,`_atendidas`.`billsec` AS `billsec`,`_atendidas`.`tempo_espera` AS `tempo_espera`,`_atendidas`.`tabela` AS `tabela`,-(1) AS `CODEVENTO`,0 AS `DURACAOEVENTO` from `SOLUTIONS`.`_atendidas` union all select `_abandonadasDACNova`.`uniqueid` AS `uniqueid`,`_abandonadasDACNova`.`linkedid` AS `linkedid`,`_abandonadasDACNova`.`calldate` AS `calldate`,`_abandonadasDACNova`.`queuetime` AS `queuetime`,`_abandonadasDACNova`.`eventtime` AS `eventtime`,`_abandonadasDACNova`.`endtime` AS `endtime`,`_abandonadasDACNova`.`src` AS `src`,`_abandonadasDACNova`.`dst` AS `dst`,`_abandonadasDACNova`.`queue_id` AS `queue_id`,`_abandonadasDACNova`.`duration` AS `duration`,`_abandonadasDACNova`.`billsec` AS `billsec`,`_abandonadasDACNova`.`tempo_espera` AS `tempo_espera`,`_abandonadasDACNova`.`tabela` AS `tabela`,-(1) AS `CODEVENTO`,0 AS `DURACAOEVENTO` from `SOLUTIONS`.`_abandonadasDACNova` union all select `_transbordo`.`uniqueid` AS `uniqueid`,`_transbordo`.`linkedid` AS `linkedid`,`_transbordo`.`calldate` AS `calldate`,`_transbordo`.`queuetime` AS `queuetime`,`_transbordo`.`eventtime` AS `eventtime`,`_transbordo`.`endtime` AS `endtime`,`_transbordo`.`src` AS `src`,`_transbordo`.`dst` AS `dst`,`_transbordo`.`queue_id` AS `queue_id`,`_transbordo`.`duration` AS `duration`,`_transbordo`.`billsec` AS `billsec`,`_transbordo`.`tempo_espera` AS `tempo_espera`,`_transbordo`.`tabela` AS `tabela`,-(1) AS `CODEVENTO`,0 AS `DURACAOEVENTO` from `SOLUTIONS`.`_transbordo` union all select `_transferencias`.`uniqueid` AS `uniqueid`,`_transferencias`.`linkedid` AS `linkedid`,`_transferencias`.`calldate` AS `calldate`,`_transferencias`.`queuetime` AS `queuetime`,`_transferencias`.`eventtime` AS `eventtime`,`_transferencias`.`endtime` AS `endtime`,`_transferencias`.`src` AS `src`,`_transferencias`.`dst` AS `dst`,`_transferencias`.`queue_id` AS `queue_id`,`_transferencias`.`duration` AS `duration`,`_transferencias`.`billsec` AS `billsec`,`_transferencias`.`tempo_espera` AS `tempo_espera`,`_transferencias`.`tabela` AS `tabela`,-(1) AS `CODEVENTO`,0 AS `DURACAOEVENTO` from `SOLUTIONS`.`_transferencias` union all select `_rejeitadas`.`uniqueid` AS `uniqueid`,`_rejeitadas`.`linkedid` AS `linkedid`,`_rejeitadas`.`calldate` AS `calldate`,`_rejeitadas`.`queuetime` AS `queuetime`,`_rejeitadas`.`eventtime` AS `eventtime`,`_rejeitadas`.`endtime` AS `endtime`,`_rejeitadas`.`src` AS `src`,`_rejeitadas`.`dst` AS `dst`,`_rejeitadas`.`queue_id` AS `queue_id`,`_rejeitadas`.`duration` AS `duration`,`_rejeitadas`.`billsec` AS `billsec`,`_rejeitadas`.`tempo_espera` AS `tempo_espera`,`_rejeitadas`.`tabela` AS `tabela`,-(1) AS `CODEVENTO`,0 AS `DURACAOEVENTO` from `SOLUTIONS`.`_rejeitadas` union all select `_efetuadas`.`uniqueid` AS `uniqueid`,`_efetuadas`.`linkedid` AS `linkedid`,`_efetuadas`.`calldate` AS `calldate`,`_efetuadas`.`queuetime` AS `queuetime`,`_efetuadas`.`eventtime` AS `eventtime`,`_efetuadas`.`endtime` AS `endtime`,`_efetuadas`.`src` AS `src`,`_efetuadas`.`dst` AS `dst`,`_efetuadas`.`queue_id` AS `queue_id`,`_efetuadas`.`duration` AS `duration`,`_efetuadas`.`billsec` AS `billsec`,`_efetuadas`.`tempo_espera` AS `tempo_espera`,`_efetuadas`.`tabela` AS `tabela`,-(1) AS `CODEVENTO`,0 AS `DURACAOEVENTO` from `SOLUTIONS`.`_efetuadas` union all select NULL AS `uniqueid`,NULL AS `linkedid`,cast(`ev`.`INICIO` as date) AS `calldate`,`ev`.`INICIO` AS `queuetime`,0 AS `eventtime`,`ev`.`FIM` AS `endtime`,NULL AS `src`,`ev`.`RAMAL` AS `dst`,100 AS `queue_id`,0 AS `duration`,0 AS `billsec`,0 AS `tempo_espera`,('pausas' collate utf8mb4_unicode_ci) AS `tabela`,`ev`.`CODEVENTO` AS `CODEVENTO`,`ev`.`DURACAO` AS `DURACAOEVENTO` from `SOLUTIONS`.`EVENTOS` `ev`;



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_sub_Aux` AS select `_subCCP`.`calldate` AS `calldate`,cast(`_subCCP`.`queue_id` as signed) AS `COD_SERVICO`,(`tbl_interval`.`tempo` + interval 15 minute) AS `COD_FAIXA_FAI`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queuetime` end)) AS `ACDCALLS`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`duration` end),0)) AS `ACDTIME`,cast(count(distinct (case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` < concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`)) and ((`_subCCP`.`endtime` > concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`)) or (coalesce(`_subCCP`.`endtime`,'0000-00-00 00:00:00') = '0000-00-00 00:00:00')) and (`_subCCP`.`CODEVENTO` = 1) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`dst` end)) as signed) AS `QTD_AGENTES`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` <= 10) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS1`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 10) and (`_subCCP`.`tempo_espera` <= 20) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS2`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 20) and (`_subCCP`.`tempo_espera` <= 30) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS3`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 30) and (`_subCCP`.`tempo_espera` <= 40) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS4`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 40) and (`_subCCP`.`tempo_espera` <= 50) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS5`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 50) and (`_subCCP`.`tempo_espera` <= 60) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS6`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 60) and (`_subCCP`.`tempo_espera` <= 70) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS7`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 70) and (`_subCCP`.`tempo_espera` <= 80) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS8`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 80) and (`_subCCP`.`tempo_espera` <= 90) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS9`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 90) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `ACDCALLS10`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` <= 10) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS1`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 10) and (`_subCCP`.`tempo_espera` <= 20) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS2`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 20) and (`_subCCP`.`tempo_espera` <= 30) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS3`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 30) and (`_subCCP`.`tempo_espera` <= 40) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS4`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 40) and (`_subCCP`.`tempo_espera` <= 50) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS5`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 50) and (`_subCCP`.`tempo_espera` <= 60) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS6`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 60) and (`_subCCP`.`tempo_espera` <= 70) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS7`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 70) and (`_subCCP`.`tempo_espera` <= 80) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS8`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 80) and (`_subCCP`.`tempo_espera` <= 90) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS9`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`tempo_espera` > 90) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ABNCALLS10`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` <> 1) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 2) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME0`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 3) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME1`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 4) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME2`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 5) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME3`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 6) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME4`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 7) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME5`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 8) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME6`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 9) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME7`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 10) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME8`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 11) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME9`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 12) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME10`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 13) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME11`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 14) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME12`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 15) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME13`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 16) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME14`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 17) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME15`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 18) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME16`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 19) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME17`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 20) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME18`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'pausas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (`_subCCP`.`CODEVENTO` = 21) and (`_subCCP`.`queue_id` = 100)) then `_subCCP`.`DURACAOEVENTO` else 0 end),0)) AS `TI_AUXTIME19`,count((case when ((`_subCCP`.`tabela` in ('atendidas','abandonadas')) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `QUEUEDCALLS`,sum(coalesce((case when ((`_subCCP`.`tabela` in ('atendidas','abandonadas')) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then (case when (`_subCCP`.`tempo_espera` < 0) then 0 else `_subCCP`.`tempo_espera` end) else 0 end),0)) AS `QUEUEDTIME`,count((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`tempo_espera` > 0) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `QUEUEDANSCALLS`,count((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `QUEUEDABNCALLS`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'atendidas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then (case when (`_subCCP`.`tempo_espera` < 0) then 0 else `_subCCP`.`tempo_espera` end) else 0 end),0)) AS `QUEUEDANSTIME`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then (case when (`_subCCP`.`tempo_espera` < 0) then 0 else `_subCCP`.`tempo_espera` end) else 0 end),0)) AS `QUEUEDABNTIME`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then (case when (`_subCCP`.`tempo_espera` < 0) then 0 else `_subCCP`.`tempo_espera` end) else 0 end),0)) AS `ABNTIME`,count((case when ((`_subCCP`.`tabela` = 'transferencias') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and exists(select 1 from `SOLUTIONS`.`AGENTES` `ag` where ((convert(`ag`.`AGENTEID` using utf8mb4) collate utf8mb4_unicode_ci) = `_subCCP`.`dst`))) then `_subCCP`.`dst` end)) AS `TRSINCALLS`,count((case when ((`_subCCP`.`tabela` = 'transferencias') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second))) and (not(exists(select 1 from `SOLUTIONS`.`AGENTES` `ag` where ((convert(`ag`.`AGENTEID` using utf8mb4) collate utf8mb4_unicode_ci) = `_subCCP`.`dst`))))) then `_subCCP`.`dst` end)) AS `TRSOUTCALLS`,count((case when ((`_subCCP`.`tabela` = 'rejeitadas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `REJCALLS`,max((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`duration` end)) AS `MAX_QUEUEDANSTIME`,count((case when ((`_subCCP`.`tabela` = 'efetuadas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `OUTCALLS`,sum(coalesce((case when ((`_subCCP`.`tabela` = 'efetuadas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`duration` end),0)) AS `OUTTIME`,max((case when ((`_subCCP`.`tabela` = 'abandonadas') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`duration` end)) AS `MAX_ABNTIME`,900 AS `AVAILTIME`,count((case when ((`_subCCP`.`tabela` = 'transbordo') and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`dst` end)) AS `TRBCALLS`,count((case when ((`_subCCP`.`tabela` in ('atendidas','abandonadas')) and (`_subCCP`.`queuetime` between concat_ws(' ',cast(`_subCCP`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`_subCCP`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `_subCCP`.`queue_id` end)) AS `ACDOFFER` from (`SOLUTIONS`.`_faixa_tempo_aux` `tbl_interval` join `SOLUTIONS`.`_subContextoChamadasPausas` `_subCCP` on(1)) group by `_subCCP`.`calldate`,(`tbl_interval`.`tempo` + interval 15 minute),cast(`_subCCP`.`queue_id` as signed);






CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_sub_evento_agente_atividade_ll` AS select cast(1 as signed) AS `ACD`,cast(`ag`.`CHAVE` as signed) AS `COD_LOGIN`,cast(`ev`.`INICIO` as date) AS `DAT_EVENTO`,cast(`ev`.`CODEVENTO` as char(50) charset utf8mb4) AS `COD_ATIVIDADE`,cast(cast(`ev`.`INICIO` as time) as time) AS `HOR_EVENTO`,'LI' AS `FLG_EVENTO` from (`EVENTOS` `ev` join `AGENTES` `ag` on((`ag`.`AGENTEID` = `ev`.`AGENTEID`))) where ((`ev`.`CODEVENTO` <> 1) and (coalesce(`ev`.`INICIO`,'0000-00-00 00:00:00') <> '0000-00-00 00:00:00')) union all select cast(1 as signed) AS `ACD`,cast(`ag`.`CHAVE` as signed) AS `COD_LOGIN`,cast(`ev`.`FIM` as date) AS `DAT_EVENTO`,cast(`ev`.`CODEVENTO` as char(50) charset utf8mb4) AS `COD_ATIVIDADE`,cast(cast(`ev`.`FIM` as time) as time) AS `HOR_EVENTO`,'LO' AS `FLG_EVENTO` from (`EVENTOS` `ev` join `AGENTES` `ag` on((`ag`.`AGENTEID` = `ev`.`AGENTEID`))) where ((`ev`.`CODEVENTO` <> 1) and (coalesce(`ev`.`FIM`,'0000-00-00 00:00:00') <> '0000-00-00 00:00:00'));




CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_sub_evento_agente_ll` AS select cast(1 as signed) AS `ACD`,cast(`ag`.`CHAVE` as signed) AS `COD_LOGIN`,cast(`ev`.`INICIO` as date) AS `DAT_EVENTO`,cast(cast(`ev`.`INICIO` as time) as time) AS `HOR_EVENTO`,'LI' AS `FLG_EVENTO` from (`EVENTOS` `ev` join `AGENTES` `ag` on((`ag`.`AGENTEID` = `ev`.`AGENTEID`))) where ((`ev`.`CODEVENTO` = 1) and (coalesce(`ev`.`INICIO`,'0000-00-00 00:00:00') <> '0000-00-00 00:00:00')) union all select cast(1 as signed) AS `ACD`,cast(`ag`.`CHAVE` as signed) AS `COD_LOGIN`,cast(`ev`.`FIM` as date) AS `DAT_EVENTO`,cast(cast(`ev`.`FIM` as time) as time) AS `HOR_EVENTO`,'LO' AS `FLG_EVENTO` from (`EVENTOS` `ev` join `AGENTES` `ag` on((`ag`.`AGENTEID` = `ev`.`AGENTEID`))) where ((`ev`.`CODEVENTO` = 1) and (coalesce(`ev`.`FIM`,'0000-00-00 00:00:00') <> '0000-00-00 00:00:00'));








CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `_subFinal` AS select `sub`.`calldate` AS `calldate`,`sub`.`COD_SERVICO` AS `COD_SERVICO`,`sub`.`COD_FAIXA_FAI` AS `COD_FAIXA_FAI`,(((((((((`sub`.`ACDCALLS1` + `sub`.`ACDCALLS2`) + `sub`.`ACDCALLS3`) + `sub`.`ACDCALLS4`) + `sub`.`ACDCALLS5`) + `sub`.`ACDCALLS6`) + `sub`.`ACDCALLS7`) + `sub`.`ACDCALLS8`) + `sub`.`ACDCALLS9`) + `sub`.`ACDCALLS10`) AS `ACDCALLS`,`sub`.`ACDTIME` AS `ACDTIME`,`sub`.`QTD_AGENTES` AS `QTD_AGENTES`,`sub`.`ACDCALLS1` AS `ACDCALLS1`,`sub`.`ACDCALLS2` AS `ACDCALLS2`,`sub`.`ACDCALLS3` AS `ACDCALLS3`,`sub`.`ACDCALLS4` AS `ACDCALLS4`,`sub`.`ACDCALLS5` AS `ACDCALLS5`,`sub`.`ACDCALLS6` AS `ACDCALLS6`,`sub`.`ACDCALLS7` AS `ACDCALLS7`,`sub`.`ACDCALLS8` AS `ACDCALLS8`,`sub`.`ACDCALLS9` AS `ACDCALLS9`,`sub`.`ACDCALLS10` AS `ACDCALLS10`,(((((((((`sub`.`ABNCALLS1` + `sub`.`ABNCALLS2`) + `sub`.`ABNCALLS3`) + `sub`.`ABNCALLS4`) + `sub`.`ABNCALLS5`) + `sub`.`ABNCALLS6`) + `sub`.`ABNCALLS7`) + `sub`.`ABNCALLS8`) + `sub`.`ABNCALLS9`) + `sub`.`ABNCALLS10`) AS `ABNCALLS`,`sub`.`ABNCALLS1` AS `ABNCALLS1`,`sub`.`ABNCALLS2` AS `ABNCALLS2`,`sub`.`ABNCALLS3` AS `ABNCALLS3`,`sub`.`ABNCALLS4` AS `ABNCALLS4`,`sub`.`ABNCALLS5` AS `ABNCALLS5`,`sub`.`ABNCALLS6` AS `ABNCALLS6`,`sub`.`ABNCALLS7` AS `ABNCALLS7`,`sub`.`ABNCALLS8` AS `ABNCALLS8`,`sub`.`ABNCALLS9` AS `ABNCALLS9`,`sub`.`ABNCALLS10` AS `ABNCALLS10`,`sub`.`TI_AUXTIME` AS `TI_AUXTIME`,`sub`.`TI_AUXTIME0` AS `TI_AUXTIME0`,`sub`.`TI_AUXTIME1` AS `TI_AUXTIME1`,`sub`.`TI_AUXTIME2` AS `TI_AUXTIME2`,`sub`.`TI_AUXTIME3` AS `TI_AUXTIME3`,`sub`.`TI_AUXTIME4` AS `TI_AUXTIME4`,`sub`.`TI_AUXTIME5` AS `TI_AUXTIME5`,`sub`.`TI_AUXTIME6` AS `TI_AUXTIME6`,`sub`.`TI_AUXTIME7` AS `TI_AUXTIME7`,`sub`.`TI_AUXTIME8` AS `TI_AUXTIME8`,`sub`.`TI_AUXTIME9` AS `TI_AUXTIME9`,`sub`.`TI_AUXTIME10` AS `TI_AUXTIME10`,`sub`.`TI_AUXTIME11` AS `TI_AUXTIME11`,`sub`.`TI_AUXTIME12` AS `TI_AUXTIME12`,`sub`.`TI_AUXTIME13` AS `TI_AUXTIME13`,`sub`.`TI_AUXTIME14` AS `TI_AUXTIME14`,`sub`.`TI_AUXTIME15` AS `TI_AUXTIME15`,`sub`.`TI_AUXTIME16` AS `TI_AUXTIME16`,`sub`.`TI_AUXTIME17` AS `TI_AUXTIME17`,`sub`.`TI_AUXTIME18` AS `TI_AUXTIME18`,`sub`.`TI_AUXTIME19` AS `TI_AUXTIME19`,`sub`.`QUEUEDCALLS` AS `QUEUEDCALLS`,`sub`.`QUEUEDTIME` AS `QUEUEDTIME`,`sub`.`QUEUEDANSCALLS` AS `QUEUEDANSCALLS`,`sub`.`QUEUEDABNCALLS` AS `QUEUEDABNCALLS`,`sub`.`QUEUEDANSTIME` AS `QUEUEDANSTIME`,`sub`.`QUEUEDABNTIME` AS `QUEUEDABNTIME`,`sub`.`ABNTIME` AS `ABNTIME`,`sub`.`TRSINCALLS` AS `TRSINCALLS`,`sub`.`TRSOUTCALLS` AS `TRSOUTCALLS`,`sub`.`REJCALLS` AS `REJCALLS`,`sub`.`MAX_QUEUEDANSTIME` AS `MAX_QUEUEDANSTIME`,`sub`.`OUTCALLS` AS `OUTCALLS`,`sub`.`OUTTIME` AS `OUTTIME`,`sub`.`MAX_ABNTIME` AS `MAX_ABNTIME`,`sub`.`AVAILTIME` AS `AVAILTIME`,`sub`.`TRBCALLS` AS `TRBCALLS`,`sub`.`ACDOFFER` AS `ACDOFFER` from `SOLUTIONS`.`_sub_Aux` `sub` where (`sub`.`COD_SERVICO` is not null);



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `PRIMO_ROSSI_AUXTIME` AS select `qm`.`id` AS `QUEUE`,`ev`.`EVENTO` AS `EVENTO`,`ev`.`STATUS` AS `STATUS`,cast(`ev`.`INICIO` as date) AS `DATE`,sum((case when (`ev`.`TIPO` = 'PRODUTIVO') then `ev`.`DURACAO` end)) AS `ACWTIME`,sum(`ev`.`TIMEVENTINCALL`) AS `HOLDTIME`,cast(sum((case when ((`ev`.`TIPO` = 'IMPRODUTIVO') and find_in_set(`ev`.`CODEVENTO`,'2,3,4,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23')) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `TI_AUXTIME`,cast(sum((case when (`ev`.`CODEVENTO` = 2) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME0`,cast(sum((case when (`ev`.`CODEVENTO` = 3) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME1`,cast(sum((case when (`ev`.`CODEVENTO` = 4) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME2`,cast(sum((case when (`ev`.`CODEVENTO` = 5) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME3`,cast(sum((case when (`ev`.`CODEVENTO` = 8) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME4`,cast(sum((case when (`ev`.`CODEVENTO` = 9) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME5`,cast(sum((case when (`ev`.`CODEVENTO` = 10) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME6`,cast(sum((case when (`ev`.`CODEVENTO` = 11) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME7`,cast(sum((case when (`ev`.`CODEVENTO` = 12) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME8`,cast(sum((case when (`ev`.`CODEVENTO` = 13) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME9`,cast(sum((case when (`ev`.`CODEVENTO` = 14) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME10`,cast(sum((case when (`ev`.`CODEVENTO` = 15) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME11`,cast(sum((case when (`ev`.`CODEVENTO` = 16) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME12`,cast(sum((case when (`ev`.`CODEVENTO` = 17) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME13`,cast(sum((case when (`ev`.`CODEVENTO` = 18) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME14`,cast(sum((case when (`ev`.`CODEVENTO` = 19) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME15`,cast(sum((case when (`ev`.`CODEVENTO` = 20) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME16`,cast(sum((case when (`ev`.`CODEVENTO` = 21) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME17`,cast(sum((case when (`ev`.`CODEVENTO` = 22) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME18`,cast(sum((case when (`ev`.`CODEVENTO` = 23) then `ev`.`DURACAO` end)) as decimal(18,0)) AS `AGTS_TI_AUXTIME19` from (`SOLUTIONS`.`EVENTOS` `ev` join `asterisk`.`queues_details` `qm` on((substring_index(substring_index(convert(`qm`.`data` using utf8mb4),'@',1),'/',-(1)) = convert(`ev`.`RAMAL` using utf8mb4)))) where ((`ev`.`EVENTO` = 'PAUSA') and (`ev`.`STATUS` = 'FECHADO') and (cast(`ev`.`INICIO` as date) = curdate())) group by `qm`.`id`,cast(`ev`.`INICIO` as date);




CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `cdr_calldate_today` AS select `asteriskcdrdb`.`cdr_logs`.`calldate` AS `calldate`,`asteriskcdrdb`.`cdr_logs`.`clid` AS `clid`,`asteriskcdrdb`.`cdr_logs`.`src` AS `src`,`asteriskcdrdb`.`cdr_logs`.`dst` AS `dst`,`asteriskcdrdb`.`cdr_logs`.`dcontext` AS `dcontext`,`asteriskcdrdb`.`cdr_logs`.`channel` AS `channel`,`asteriskcdrdb`.`cdr_logs`.`dstchannel` AS `dstchannel`,`asteriskcdrdb`.`cdr_logs`.`lastapp` AS `lastapp`,`asteriskcdrdb`.`cdr_logs`.`lastdata` AS `lastdata`,`asteriskcdrdb`.`cdr_logs`.`duration` AS `duration`,`asteriskcdrdb`.`cdr_logs`.`billsec` AS `billsec`,`asteriskcdrdb`.`cdr_logs`.`disposition` AS `disposition`,`asteriskcdrdb`.`cdr_logs`.`amaflags` AS `amaflags`,`asteriskcdrdb`.`cdr_logs`.`accountcode` AS `accountcode`,`asteriskcdrdb`.`cdr_logs`.`uniqueid` AS `uniqueid`,`asteriskcdrdb`.`cdr_logs`.`userfield` AS `userfield`,`asteriskcdrdb`.`cdr_logs`.`recordingfile` AS `recordingfile`,`asteriskcdrdb`.`cdr_logs`.`cnum` AS `cnum`,`asteriskcdrdb`.`cdr_logs`.`cnam` AS `cnam`,`asteriskcdrdb`.`cdr_logs`.`outbound_cnum` AS `outbound_cnum`,`asteriskcdrdb`.`cdr_logs`.`outbound_cnam` AS `outbound_cnam`,`asteriskcdrdb`.`cdr_logs`.`dst_cnam` AS `dst_cnam`,`asteriskcdrdb`.`cdr_logs`.`did` AS `did`,`asteriskcdrdb`.`cdr_logs`.`tipo` AS `tipo`,`asteriskcdrdb`.`cdr_logs`.`operadora` AS `operadora`,`asteriskcdrdb`.`cdr_logs`.`AGENTEID` AS `AGENTEID` from `asteriskcdrdb`.`cdr_logs` where (`asteriskcdrdb`.`cdr_logs`.`calldate` between concat_ws(' ',curdate(),' 00:00:00') and concat_ws(' ',curdate(),' 23:59:59'));



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `cdr_agentes_view` AS select `c`.`calldate` AS `calldate`,`c`.`clid` AS `clid`,`c`.`src` AS `src`,`c`.`dst` AS `dst`,`c`.`dcontext` AS `dcontext`,`c`.`channel` AS `channel`,`c`.`dstchannel` AS `dstchannel`,`c`.`lastapp` AS `lastapp`,`c`.`lastdata` AS `lastdata`,`c`.`duration` AS `duration`,`c`.`billsec` AS `billsec`,`c`.`disposition` AS `disposition`,`c`.`amaflags` AS `amaflags`,`c`.`accountcode` AS `accountcode`,`c`.`uniqueid` AS `uniqueid`,`c`.`userfield` AS `userfield`,`c`.`tipo` AS `tipo`,`a`.`CHAVE` AS `CHAVE`,`a`.`CRIADO` AS `CRIADO`,`a`.`AGENTEID` AS `AGENTEID`,`a`.`SENHA` AS `SENHA`,`a`.`NOME` AS `NOME`,`a`.`STATUS` AS `STATUS`,`a`.`OBS` AS `OBS`,`a`.`PERFIL` AS `PERFIL`,`a`.`ramal` AS `ramal`,`a`.`projeto` AS `projeto`,`a`.`USUARIO_CRM` AS `USUARIO_CRM`,(time_to_sec(`c`.`calldate`) + `c`.`duration`) AS `timeSec`,`a`.`Turno` AS `Turno`,`a`.`LOGIN_CRM` AS `LOGIN_CRM` from (`asteriskcdrdb`.`cdr_logs` `c` left join `SOLUTIONS`.`AGENTES` `a` on((convert(`c`.`src` using utf8mb4) = convert(`a`.`ramal` using utf8mb4))));



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `eventos_agentes_view` AS select `c`.`CHAVE` AS `chave`,`c`.`RAMAL` AS `ramal`,`c`.`AGENTEID` AS `agenteid`,`c`.`EVENTO` AS `evento`,`c`.`TIPO` AS `tipo`,`c`.`CODEVENTO` AS `codevento`,`c`.`INICIO` AS `inicio`,`c`.`FIM` AS `fim`,`c`.`DURACAO` AS `duracao`,`c`.`STATUS` AS `status`,`c`.`CANALIN` AS `canalin`,`c`.`CANALOUT` AS `canalout`,`c`.`OUTROS` AS `outros`,`a`.`CHAVE` AS `CHAVE2`,`a`.`CRIADO` AS `CRIADO`,`a`.`AGENTEID` AS `AGENTEID2`,`a`.`SENHA` AS `SENHA`,`a`.`NOME` AS `NOME`,`a`.`STATUS` AS `STATUS2`,`a`.`OBS` AS `OBS`,`a`.`PERFIL` AS `PERFIL`,`a`.`ramal` AS `ramal2`,`a`.`projeto` AS `projeto`,`a`.`USUARIO_CRM` AS `USUARIO_CRM`,`a`.`Turno` AS `Turno` from (`EVENTOS` `c` left join `AGENTES` `a` on((`c`.`RAMAL` = `a`.`ramal`)));




CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `ezcall_agent_events` AS select `Pausa`.`CODPAUSA` AS `CODPAUSA`,`Pausa`.`TIPO` AS `TIPO`,`Pausa`.`LIMITE` AS `LIMITE`,`Pausa`.`TOLERANCIA` AS `TOLERANCIA`,cast(`Evento`.`INICIO` as date) AS `DATA`,sum(`Evento`.`DURACAO`) AS `DURACAO`,`Evento`.`PROJECTID` AS `PROJECTID`,count(distinct `Evento`.`AGENTEID`) AS `TOTALAGENTES`,count(0) AS `TOTALEVENTOS`,cast(avg(`Evento`.`DURACAO`) as signed) AS `TEMPOMEDIOTOTAL`,cast((sum(`Evento`.`DURACAO`) / count(distinct `Evento`.`AGENTEID`)) as signed) AS `TEMPOMEDIOAGENTE` from (`EVENTOS` `Evento` left join `PAUSAS` `Pausa` on((`Pausa`.`CODPAUSA` = `Evento`.`CODEVENTO`))) where ((`Evento`.`EVENTO` = 'PAUSA') and (`Evento`.`STATUS` = 'FECHADO')) group by `Pausa`.`CODPAUSA`,cast(`Evento`.`INICIO` as date),`Evento`.`PROJECTID` order by cast(`Evento`.`INICIO` as date);



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `ezcall_incoming_calls` AS select `Cdr`.`uniqueid` AS `uniqueid`,'Entrada' AS `tipo`,`Cdr`.`clid` AS `clid`,right(`Cdr`.`recordingfile`,locate('.',reverse(`Cdr`.`recordingfile`))) AS `fileext`,right(`Cdr`.`recordingfile`,(locate('-',reverse(`Cdr`.`recordingfile`)) - 1)) AS `filename`,(select replace(`Cdr`.`filename`,`fileext`,'')) AS `parentid`,(select `asteriskcdrdb`.`cdr_logs`.`dst` AS `queue_id` from `asteriskcdrdb`.`cdr_logs` where (`asteriskcdrdb`.`cdr_logs`.`uniqueid` = `parentid`) limit 1) AS `queue_id`,min(`Cdr`.`calldate`) AS `calldate`,(select substr(`asteriskcdrdb`.`cdr_logs`.`dstchannel`,(locate('/',`asteriskcdrdb`.`cdr_logs`.`dstchannel`) + 1),((char_length(`asteriskcdrdb`.`cdr_logs`.`dstchannel`) - locate('@',reverse(`asteriskcdrdb`.`cdr_logs`.`dstchannel`))) - locate('/',`asteriskcdrdb`.`cdr_logs`.`dstchannel`))) from `asteriskcdrdb`.`cdr_logs` where ((`asteriskcdrdb`.`cdr_logs`.`uniqueid` = `parentid`) and (`asteriskcdrdb`.`cdr_logs`.`disposition` = 'ANSWERED')) group by `asteriskcdrdb`.`cdr_logs`.`uniqueid`) AS `extension`,(case when (select isnull(`extension`)) then 'NO ANSWERED' else 'ANSWERED' end) AS `disposition`,(select `extension`) AS `src`,`Cdr`.`src` AS `dst`,(case when (select (`extension` is not null)) then sum(`Cdr`.`billsec`) else 0 end) AS `billsec`,(case when (select (`extension` is not null)) then (max(`Cdr`.`duration`) + (time_to_sec(max(`Cdr`.`calldate`)) - time_to_sec(min(`Cdr`.`calldate`)))) else (max(`Cdr`.`duration`) + (max(`Cdr`.`calldate`) - min(`Cdr`.`calldate`))) end) AS `duration`,`Cdr`.`cnum` AS `cnum` from `asteriskcdrdb`.`cdr_logs` `Cdr` where ((cast(`Cdr`.`calldate` as date) between '2021-02-19' and '2021-02-19') and (`Cdr`.`recordingfile` <> '') and (`Cdr`.`dstchannel` <> '') and (`Cdr`.`lastdata` <> '') and (`Cdr`.`duration` > 0) and (substr(`Cdr`.`src`,1,4) <> 'DISC') and (length(`Cdr`.`src`) > 4) and (length(`Cdr`.`dst`) = 4) and (`Cdr`.`lastapp` = 'Dial') and (locate(`Cdr`.`dst`,`Cdr`.`dstchannel`) > 0)) group by (select replace(`Cdr`.`filename`,`fileext`,''));



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `ezcall_view_today_abandoned_queue_calls` AS select 'Abandonada' AS `tipo`,`Cel`.`uniqueid` AS `uniqueid`,ifnull(min((case when (`Cel`.`eventtype` = 'ANSWER') then `Cel`.`exten` end)),0) AS `queue_id`,min((case when (`Cel`.`eventtype` = 'CHAN_START') then `Cel`.`eventtime` end)) AS `calldate`,NULL AS `src`,`Cel`.`cid_num` AS `dst`,NULL AS `extension`,if(count(distinct (case when (`Cel`.`eventtype` = 'BRIDGE_ENTER') then 1 end)),1,0) AS `qtd_aten`,if(count(distinct (case when (`Cel`.`eventtype` = 'BRIDGE_ENTER') then 1 end)),'ANSWERED','NO ANSWERED') AS `disposition`,ifnull(time_to_sec(timediff(min((case when (`Cel`.`eventtype` = 'CHAN_END') then `Cel`.`eventtime` end)),min((case when (`Cel`.`eventtype` = 'CHAN_START') then `Cel`.`eventtime` end)))),0) AS `duration`,0 AS `billsec` from `asteriskcdrdb`.`cel_logs` `Cel` where ((1 = 1) and (`Cel`.`channame` like 'SIP/TRAVAYA-%') and (`Cel`.`uniqueid` = `Cel`.`linkedid`) and (cast(`Cel`.`eventtime` as date) = curdate())) group by `Cel`.`linkedid` having ((`disposition` = 'NO ANSWERED') and (`queue_id` <> 0));


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `ezcall_view_today_answered_queue_calls` AS select 'Entrada' AS `tipo`,`Cel`.`uniqueid` AS `uniqueid`,ifnull(`Answered`.`exten`,0) AS `queue_id`,min(`Answered`.`eventtime`) AS `calldate`,substring_index(substring_index(`Cel`.`peer`,'-',1),'SIP/',-(1)) AS `src`,`Cel`.`cid_num` AS `dst`,substring_index(substring_index(`Cel`.`peer`,'-',1),'SIP/',-(1)) AS `extension`,1 AS `qtd_aten`,'ANSWERED' AS `disposition`,ifnull(time_to_sec(cast(timediff(max((case when (`Cel`.`eventtype` = 'BRIDGE_EXIT') then `Cel`.`eventtime` end)),min(`Answered`.`eventtime`)) as time)),0) AS `duration`,ifnull(time_to_sec(cast(timediff(max((case when (`Cel`.`eventtype` = 'BRIDGE_EXIT') then `Cel`.`eventtime` end)),min((case when (`Cel`.`eventtype` = 'BRIDGE_ENTER') then `Cel`.`eventtime` end))) as time)),0) AS `billsec` from (`asteriskcdrdb`.`cel_logs` `Cel` left join `asteriskcdrdb`.`cel_logs` `Answered` on(((`Answered`.`linkedid` = `Cel`.`linkedid`) and (`Answered`.`eventtype` = 'ANSWER') and (`Answered`.`context` = 'ext-queues') and (cast(`Answered`.`eventtime` as date) = curdate())))) where ((1 = 1) and (`Cel`.`eventtype` in ('BRIDGE_ENTER','BRIDGE_EXIT')) and (`Cel`.`appname` = 'Dial') and (cast(`Cel`.`eventtime` as date) = curdate())) group by `Cel`.`uniqueid` having ((`dst` regexp '^[0-9]+$') and (`queue_id` <> 0)) order by `Cel`.`eventtime`;




CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `ezcall_view_today_queue_calls` AS select 'ENTRADA' AS `tipo`,`asteriskcdrdb`.`call_histories`.`uniqueid` AS `uniqueid`,`asteriskcdrdb`.`call_histories`.`entertime` AS `calldate`,`asteriskcdrdb`.`call_histories`.`extension` AS `src`,`asteriskcdrdb`.`call_histories`.`number` AS `dst`,`asteriskcdrdb`.`call_histories`.`queueid` AS `queue_id`,(case when (`asteriskcdrdb`.`call_histories`.`answered` = 'S') then 'ANSWERED' else 'NO ANSWERED' end) AS `disposition`,`asteriskcdrdb`.`call_histories`.`duration` AS `duration`,`asteriskcdrdb`.`call_histories`.`billsec` AS `billsec` from `asteriskcdrdb`.`call_histories` where ((`asteriskcdrdb`.`call_histories`.`direction` = 'INCOMING') and (`asteriskcdrdb`.`call_histories`.`queueid` is not null) and (`asteriskcdrdb`.`call_histories`.`lastevent` = 'CHAN_END') and (cast(`asteriskcdrdb`.`call_histories`.`entertime` as date) = curdate()));



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `ezcall_vw_agent_day_status` AS select `Agente`.`AGENTEID` AS `agente_id`,`Agente`.`ramal` AS `extension`,ifnull(max((`LastCall`.`calldate` + interval `LastCall`.`duration` second)),0) AS `last_call`,ifnull(max((case when (`EventoPausa`.`STATUS` = 'ABERTO') then `EventoPausa`.`CODEVENTO` end)),0) AS `pause_id`,ifnull(if(count(distinct (case when (`EventoPausa`.`STATUS` = 'ABERTO') then 1 end)),cast(max(`EventoPausa`.`INICIO`) as datetime),cast(max(`EventoPausa`.`FIM`) as datetime)),0) AS `last_pause`,ifnull(cast(max(`EventoLogin`.`INICIO`) as datetime),0) AS `last_login`,cast(greatest(ifnull(max((`LastCall`.`calldate` + interval `LastCall`.`duration` second)),0),ifnull(if(count(distinct (case when (`EventoPausa`.`STATUS` = 'ABERTO') then 1 end)),cast(max(`EventoPausa`.`INICIO`) as datetime),cast(max(`EventoPausa`.`FIM`) as datetime)),0),ifnull(max(`EventoLogin`.`INICIO`),0)) as datetime) AS `last_event`,timediff(now(),cast(greatest(ifnull(max((`LastCall`.`calldate` + interval `LastCall`.`duration` second)),0),ifnull(if(count(distinct (case when (`EventoPausa`.`STATUS` = 'ABERTO') then 1 end)),cast(max(`EventoPausa`.`INICIO`) as datetime),cast(max(`EventoPausa`.`FIM`) as datetime)),0),ifnull(max(`EventoLogin`.`INICIO`),0)) as datetime)) AS `idle`,count(`EventoPausa`.`VALIDADO`) AS `frequency`,if(`EventoPausa`.`VALIDADO`,1,0) AS `event_validated`,if(`EventoLogin`.`VALIDADO`,1,0) AS `login_validated`,if(`EventoLogin`.`CODEVENTO`,1,0) AS `login_id` from (((`AGENTES` `Agente` left join `ezcall_lastcall` `LastCall` on(((cast(`LastCall`.`calldate` as date) = cast(now() as date)) and (convert(`LastCall`.`extension` using utf8mb4) = convert(`Agente`.`ramal` using utf8mb4))))) left join `EVENTOS` `EventoPausa` on(((`EventoPausa`.`RAMAL` = `Agente`.`ramal`) and (`EventoPausa`.`EVENTO` = 'PAUSA') and (cast(`EventoPausa`.`INICIO` as date) = cast(now() as date))))) left join `EVENTOS` `EventoLogin` on(((`EventoLogin`.`RAMAL` = `Agente`.`ramal`) and (`EventoLogin`.`EVENTO` = 'LOGIN') and (`EventoLogin`.`STATUS` = 'ABERTO') and (cast(`EventoLogin`.`INICIO` as date) = cast(now() as date))))) where (cast(`EventoLogin`.`INICIO` as date) = cast(now() as date)) group by `Agente`.`ramal`;



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `CCM7_ADERENCIA` AS select (case when isnull(`EventoLogin`.`CHAVE`) then 0 when (`Pausa`.`TIPO` = 'PRODUTIVO') then 2 when (`Pausa`.`TIPO` = 'IMPRODUTIVO') then 3 when (`ExtensionCall`.`inuse` = '1') then 5 else 1 end) AS `COD_STATUS`,`Agente`.`CHAVE` AS `COD_LOGIN`,`Agente`.`NOME` AS `NOME`,`Agente`.`ramal` AS `RAMAL`,`Pausa`.`CODPAUSA` AS `DES_PAUSA`,(case when isnull(`EventoLogin`.`CHAVE`) then 'Desconectado' when (`Pausa`.`TIPO` = 'PRODUTIVO') then 'Pausa Produtiva' when (`Pausa`.`TIPO` = 'IMPRODUTIVO') then 'Pausa Improdutiva' when (`ExtensionCall`.`inuse` = 1) then 'Em Uso' else 'Disponvel' end) AS `STATUS`,(case when (`ExtensionCall`.`inuse` = 1) then `ExtensionCall`.`duration` when ((`Pausa`.`TIPO` = 'PRODUTIVO') or (`Pausa`.`TIPO` = 'PRODUTIVO')) then time_to_sec(timediff(now(),`EventoPausa`.`INICIO`)) else (time_to_sec(now()) - (select time_to_sec(cast(greatest(`ViewAgentStatus`.`last_call`,`ViewAgentStatus`.`last_pause`,`ViewAgentStatus`.`last_login`) as datetime)))) end) AS `TEMPO`,(case when (`ExtensionCall`.`inuse` = 1) then `ExtensionCall`.`ctype` else NULL end) AS `DES_TIPO`,1 AS `ACD`,now() AS `DAT_HOR_EXTRACAO` from (((((`AGENTES` `Agente` left join `EVENTOS` `EventoLogin` on(((`EventoLogin`.`RAMAL` = `Agente`.`ramal`) and (cast(`EventoLogin`.`INICIO` as date) = curdate()) and (`EventoLogin`.`STATUS` = 'ABERTO') and (`EventoLogin`.`EVENTO` = 'LOGIN')))) left join `EVENTOS` `EventoPausa` on(((`EventoPausa`.`RAMAL` = `Agente`.`ramal`) and (`EventoPausa`.`PARENT` = `EventoLogin`.`CHAVE`) and (`EventoPausa`.`STATUS` = 'ABERTO') and (`EventoPausa`.`EVENTO` = 'PAUSA')))) left join `PAUSAS` `Pausa` on((`EventoPausa`.`CODEVENTO` = `Pausa`.`CODPAUSA`))) left join `ezcall_extension_call_status` `ExtensionCall` on((`ExtensionCall`.`extension` = `Agente`.`ramal`))) left join `ezcall_vw_agent_day_status` `ViewAgentStatus` on((`ViewAgentStatus`.`extension` = `Agente`.`ramal`))) where ((1 = 1) and (`EventoLogin`.`CHAVE` is not null)) group by `Agente`.`ramal`;







CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `CCM7_OPERACAO` AS select 1 AS `COD_SITE`,1 AS `ACD`,`Queue`.`extension` AS `COD_SPLIT_SKILL_DAC`,count((case when (`QueueCall`.`disposition` = 'ANSWERED') then 1 end)) AS `ACDCALLS`,count((case when (`QueueCall`.`disposition` <> 'ANSWERED') then 1 end)) AS `ABNCALLS`,ifnull(cast(((count((case when (`QueueCall`.`disposition` <> 'ANSWERED') then 1 end)) * 100) / count(`QueueCall`.`uniqueid`)) as decimal(12,2)),0) AS `PERC_ABAND`,ifnull(`QueueStats`.`calls`,0) AS `QUEUEDCALLS`,ifnull(max((case when (`QueueCall`.`disposition` = 'ANSWERED') then (`QueueCall`.`duration` - `QueueCall`.`billsec`) end)),0) AS `MAX_QUEUEDANSTIME`,ifnull(sum((case when (`QueueCall`.`disposition` <> 'ANSWERED') then `QueueCall`.`billsec` end)),0) AS `ACDTIME`,ifnull(cast(((count((case when ((`QueueCall`.`disposition` = 'ANSWERED') and ((`QueueCall`.`duration` - `QueueCall`.`billsec`) <= 30)) then 1 end)) / (count((case when (`QueueCall`.`disposition` = 'ANSWERED') then 1 end)) + count((case when ((`QueueCall`.`disposition` <> 'ANSWERED') and ((`QueueCall`.`duration` - `QueueCall`.`billsec`) <= 10)) then 1 end)))) * 100) as decimal(12,2)),0) AS `SLA_ACUM`,0 AS `ACWTIME`,0 AS `AGTS_OUTROS`,ifnull(`QueueStats`.`logged`,0) AS `AGTS_LOGADOS`,ifnull((`QueueStats`.`logged` - `QueueStats`.`paused`),0) AS `AGTS_DISP`,ifnull(`QueueStats`.`incall`,0) AS `AGTS_FALANDO`,ifnull((`QueueStats`.`offline` + `QueueStats`.`paused`),0) AS `AGTS_INDISP`,ifnull(`Evento`.`HOLDTIME`,0) AS `HOLDTIME`,ifnull(`Evento`.`AGTS_TI_AUXTIME0`,0) AS `AGTS_TI_AUXTIME0`,ifnull(`Evento`.`AGTS_TI_AUXTIME1`,0) AS `AGTS_TI_AUXTIME1`,ifnull(`Evento`.`AGTS_TI_AUXTIME2`,0) AS `AGTS_TI_AUXTIME2`,ifnull(`Evento`.`AGTS_TI_AUXTIME3`,0) AS `AGTS_TI_AUXTIME3`,ifnull(`Evento`.`AGTS_TI_AUXTIME4`,0) AS `AGTS_TI_AUXTIME4`,ifnull(`Evento`.`AGTS_TI_AUXTIME5`,0) AS `AGTS_TI_AUXTIME5`,ifnull(`Evento`.`AGTS_TI_AUXTIME6`,0) AS `AGTS_TI_AUXTIME6`,ifnull(`Evento`.`AGTS_TI_AUXTIME7`,0) AS `AGTS_TI_AUXTIME7`,ifnull(`Evento`.`AGTS_TI_AUXTIME8`,0) AS `AGTS_TI_AUXTIME8`,ifnull(`Evento`.`AGTS_TI_AUXTIME9`,0) AS `AGTS_TI_AUXTIME9`,ifnull(`Evento`.`AGTS_TI_AUXTIME10`,0) AS `AGTS_TI_AUXTIME10`,ifnull(`Evento`.`AGTS_TI_AUXTIME11`,0) AS `AGTS_TI_AUXTIME11`,ifnull(`Evento`.`AGTS_TI_AUXTIME12`,0) AS `AGTS_TI_AUXTIME12`,ifnull(`Evento`.`AGTS_TI_AUXTIME13`,0) AS `AGTS_TI_AUXTIME13`,ifnull(`Evento`.`AGTS_TI_AUXTIME14`,0) AS `AGTS_TI_AUXTIME14`,ifnull(`Evento`.`AGTS_TI_AUXTIME15`,0) AS `AGTS_TI_AUXTIME15`,ifnull(`Evento`.`AGTS_TI_AUXTIME16`,0) AS `AGTS_TI_AUXTIME16`,ifnull(`Evento`.`AGTS_TI_AUXTIME17`,0) AS `AGTS_TI_AUXTIME17`,ifnull(`Evento`.`AGTS_TI_AUXTIME18`,0) AS `AGTS_TI_AUXTIME18`,ifnull(`Evento`.`AGTS_TI_AUXTIME19`,0) AS `AGTS_TI_AUXTIME19`,ifnull(sum((case when (`QueueCall`.`disposition` = 'ANSWERED') then (`QueueCall`.`duration` - `QueueCall`.`billsec`) end)),0) AS `QUEUEDANSTIME`,ifnull(sum((case when (`QueueCall`.`disposition` <> 'ANSWERED') then `QueueCall`.`duration` end)),0) AS `ABNTIME`,ifnull(sum((`QueueCall`.`disposition` = 'ANSWERED')),0) AS `QUEUEDANSCALLS`,now() AS `DAT_HOR_EXTRACAO` from (((`asterisk`.`queues_config` `Queue` left join `SOLUTIONS`.`ezcall_queue_stats` `QueueStats` on(((`QueueStats`.`queue` = `Queue`.`extension`) and (`QueueStats`.`date` = cast(now() as date))))) left join `SOLUTIONS`.`PRIMO_ROSSI_AUXTIME` `Evento` on(((`Evento`.`QUEUE` = `Queue`.`extension`) and (`Evento`.`DATE` = cast(now() as date))))) left join `SOLUTIONS`.`ezcall_view_today_queue_calls` `QueueCall` on(((convert(`QueueCall`.`queue_id` using utf8mb4) = convert(`Queue`.`extension` using utf8mb4)) and (cast(`QueueCall`.`calldate` as date) = cast(now() as date))))) group by `Queue`.`extension`,`QueueStats`.`queue`;


------


CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `current_day_cdr` AS select `_efetuadas_DDAF`.`uniqueid` AS `uniqueid`,`_efetuadas_DDAF`.`linkedid` AS `linkedid`,`_efetuadas_DDAF`.`calldate` AS `calldate`,`_efetuadas_DDAF`.`queuetime` AS `queuetime`,`_efetuadas_DDAF`.`duration` AS `duration`,`_efetuadas_DDAF`.`billsec` AS `billsec`,`_efetuadas_DDAF`.`src` AS `src`,`_efetuadas_DDAF`.`dst` AS `dst`,`_efetuadas_DDAF`.`queue_id` AS `queue_id`,-(1) AS `CODEVENTO`,0 AS `DURACAOEVENTO`,`_efetuadas_DDAF`.`tabela` AS `tabela` from `SOLUTIONS`.`_efetuadas_DDAF` union all select `_atendidas_DDAF`.`uniqueid` AS `uniqueid`,`_atendidas_DDAF`.`linkedid` AS `linkedid`,`_atendidas_DDAF`.`calldate` AS `calldate`,`_atendidas_DDAF`.`queuetime` AS `queuetime`,`_atendidas_DDAF`.`duration` AS `duration`,`_atendidas_DDAF`.`billsec` AS `billsec`,`_atendidas_DDAF`.`src` AS `src`,`_atendidas_DDAF`.`dst` AS `dst`,`_atendidas_DDAF`.`queue_id` AS `queue_id`,-(1) AS `CODEVENTO`,0 AS `DURACAOEVENTO`,`_atendidas_DDAF`.`tabela` AS `tabela` from `SOLUTIONS`.`_atendidas_DDAF` union all select NULL AS `uniqueid`,NULL AS `linkedid`,cast(`ev`.`INICIO` as date) AS `calldate`,`ev`.`INICIO` AS `queuetime`,0 AS `duration`,0 AS `billsec`,NULL AS `src`,`ev`.`RAMAL` AS `dst`,0 AS `queue_id`,`ev`.`CODEVENTO` AS `CODEVENTO`,`ev`.`DURACAO` AS `DURACAOEVENTO`,'pausas' AS `tabela` from `SOLUTIONS`.`EVENTOS` `ev`;



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `DAC_DIARIO_AGENTE_ATIVIDADE_LL` AS select `sub`.`ACD` AS `ACD`,`sub`.`COD_LOGIN` AS `COD_LOGIN`,`sub`.`DAT_EVENTO` AS `DAT_EVENTO`,`sub`.`COD_ATIVIDADE` AS `COD_ATIVIDADE`,`sub`.`HOR_EVENTO` AS `HOR_EVENTO`,`sub`.`FLG_EVENTO` AS `FLG_EVENTO` from `_sub_evento_agente_atividade_ll` `sub` order by `sub`.`DAT_EVENTO`,`sub`.`COD_LOGIN`,`sub`.`HOR_EVENTO`;

--

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `DAC_DIARIO_AGENTE_FAIXA` AS select cast(1 as signed) AS `ACD`,cast(`ag`.`CHAVE` as signed) AS `COD_LOGIN`,`cdr`.`calldate` AS `DAT_ATENDIMENTO`,`cdr`.`queue_id` AS `COD_SERVICO`,(`tbl_interval`.`tempo` + interval 15 minute) AS `COD_FAIXA_FAI`,count((case when ((`cdr`.`tabela` = 'atendidas') and (`cdr`.`queue_id` <> 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`queuetime` end)) AS `ACDCALLS`,sum(coalesce((case when ((`cdr`.`tabela` = 'atendidas') and (`cdr`.`queue_id` <> 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`duration` end),0)) AS `ACDTIME`,0 AS `ACWTIME`,0 AS `HOLDTIME`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` <> 1) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 2) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME0`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 3) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME1`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 4) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME2`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 5) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME3`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 6) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME4`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 7) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME5`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 8) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME6`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 9) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME7`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 10) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME8`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 11) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME9`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 12) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME10`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 13) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME11`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 14) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME12`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 15) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME13`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 16) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME14`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 17) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME15`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 18) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME16`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 19) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME17`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 20) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME18`,cast(sum(coalesce((case when ((`cdr`.`CODEVENTO` = 21) and (`cdr`.`queue_id` = 0) and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`DURACAOEVENTO` end),0)) as decimal(18,2)) AS `TI_AUXTIME19`,count((case when ((`cdr`.`tabela` = 'efetuadas') and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`dst` end)) AS `OUTCALLS`,sum(coalesce((case when ((`cdr`.`tabela` = 'efetuadas') and (`cdr`.`queuetime` between concat_ws(' ',cast(`cdr`.`queuetime` as date),`tbl_interval`.`tempo`) and concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)))) then `cdr`.`duration` end),0)) AS `OUTTIME` from ((`SOLUTIONS`.`_faixa_tempo_aux` `tbl_interval` join `SOLUTIONS`.`current_day_cdr` `cdr` on(1)) join `SOLUTIONS`.`AGENTES` `ag` on((`ag`.`AGENTEID` = `cdr`.`dst`))) where ((`cdr`.`queue_id` is not null) and (concat_ws(' ',cast(`cdr`.`queuetime` as date),((`tbl_interval`.`tempo` + interval 14 minute) + interval 59 second)) <= (select now()))) group by cast(`ag`.`CHAVE` as signed),`cdr`.`calldate`,`cdr`.`queue_id`,(`tbl_interval`.`tempo` + interval 15 minute);



CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `DAC_DIARIO_AGENTE_LL` AS select `sub`.`ACD` AS `ACD`,`sub`.`COD_LOGIN` AS `COD_LOGIN`,`sub`.`DAT_EVENTO` AS `DAT_EVENTO`,`sub`.`HOR_EVENTO` AS `HOR_EVENTO`,`sub`.`FLG_EVENTO` AS `FLG_EVENTO` from `_sub_evento_agente_ll` `sub` order by `sub`.`DAT_EVENTO`,`sub`.`COD_LOGIN`,`sub`.`HOR_EVENTO`;




CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `DAC_DIARIO_FAIXA` AS select cast(1 as signed) AS `ACD`,`_subFinal`.`calldate` AS `DAT_ATENDIMENTO`,cast(`_subFinal`.`COD_SERVICO` as signed) AS `COD_SERVICO`,`_subFinal`.`COD_FAIXA_FAI` AS `COD_FAIXA_FAI`,cast(`_subFinal`.`ACDCALLS` as decimal(18,2)) AS `ACDCALLS`,cast(`_subFinal`.`ACDTIME` as decimal(18,2)) AS `ACDTIME`,cast(0 as decimal(18,2)) AS `ACWTIME`,cast(0 as decimal(18,2)) AS `HOLDTIME`,cast(`_subFinal`.`QTD_AGENTES` as decimal(18,2)) AS `QTD_AGENTES`,cast(`_subFinal`.`ACDCALLS1` as decimal(18,2)) AS `ACDCALLS1`,cast(`_subFinal`.`ACDCALLS2` as decimal(18,2)) AS `ACDCALLS2`,cast(`_subFinal`.`ACDCALLS3` as decimal(18,2)) AS `ACDCALLS3`,cast(`_subFinal`.`ACDCALLS4` as decimal(18,2)) AS `ACDCALLS4`,cast(`_subFinal`.`ACDCALLS5` as decimal(18,2)) AS `ACDCALLS5`,cast(`_subFinal`.`ACDCALLS6` as decimal(18,2)) AS `ACDCALLS6`,cast(`_subFinal`.`ACDCALLS7` as decimal(18,2)) AS `ACDCALLS7`,cast(`_subFinal`.`ACDCALLS8` as decimal(18,2)) AS `ACDCALLS8`,cast(`_subFinal`.`ACDCALLS9` as decimal(18,2)) AS `ACDCALLS9`,cast(`_subFinal`.`ACDCALLS10` as decimal(18,2)) AS `ACDCALLS10`,cast(`_subFinal`.`ABNCALLS` as decimal(18,2)) AS `ABNCALLS`,cast(`_subFinal`.`ABNCALLS1` as decimal(18,2)) AS `ABNCALLS1`,cast(`_subFinal`.`ABNCALLS2` as decimal(18,2)) AS `ABNCALLS2`,cast(`_subFinal`.`ABNCALLS3` as decimal(18,2)) AS `ABNCALLS3`,cast(`_subFinal`.`ABNCALLS4` as decimal(18,2)) AS `ABNCALLS4`,cast(`_subFinal`.`ABNCALLS5` as decimal(18,2)) AS `ABNCALLS5`,cast(`_subFinal`.`ABNCALLS6` as decimal(18,2)) AS `ABNCALLS6`,cast(`_subFinal`.`ABNCALLS7` as decimal(18,2)) AS `ABNCALLS7`,cast(`_subFinal`.`ABNCALLS8` as decimal(18,2)) AS `ABNCALLS8`,cast(`_subFinal`.`ABNCALLS9` as decimal(18,2)) AS `ABNCALLS9`,cast(`_subFinal`.`ABNCALLS10` as decimal(18,2)) AS `ABNCALLS10`,cast(10 as signed) AS `PERIOD1`,cast(20 as signed) AS `PERIOD2`,cast(30 as signed) AS `PERIOD3`,cast(40 as signed) AS `PERIOD4`,cast(50 as signed) AS `PERIOD5`,cast(60 as signed) AS `PERIOD6`,cast(70 as signed) AS `PERIOD7`,cast(80 as signed) AS `PERIOD8`,cast(90 as signed) AS `PERIOD9`,cast(`_subFinal`.`TI_AUXTIME` as decimal(18,2)) AS `TI_AUXTIME`,cast(`_subFinal`.`TI_AUXTIME0` as decimal(18,2)) AS `TI_AUXTIME0`,cast(`_subFinal`.`TI_AUXTIME1` as decimal(18,2)) AS `TI_AUXTIME1`,cast(`_subFinal`.`TI_AUXTIME2` as decimal(18,2)) AS `TI_AUXTIME2`,cast(`_subFinal`.`TI_AUXTIME3` as decimal(18,2)) AS `TI_AUXTIME3`,cast(`_subFinal`.`TI_AUXTIME4` as decimal(18,2)) AS `TI_AUXTIME4`,cast(`_subFinal`.`TI_AUXTIME5` as decimal(18,2)) AS `TI_AUXTIME5`,cast(`_subFinal`.`TI_AUXTIME6` as decimal(18,2)) AS `TI_AUXTIME6`,cast(`_subFinal`.`TI_AUXTIME7` as decimal(18,2)) AS `TI_AUXTIME7`,cast(`_subFinal`.`TI_AUXTIME8` as decimal(18,2)) AS `TI_AUXTIME8`,cast(`_subFinal`.`TI_AUXTIME9` as decimal(18,2)) AS `TI_AUXTIME9`,cast(`_subFinal`.`TI_AUXTIME10` as decimal(18,2)) AS `TI_AUXTIME10`,cast(`_subFinal`.`TI_AUXTIME11` as decimal(18,2)) AS `TI_AUXTIME11`,cast(`_subFinal`.`TI_AUXTIME12` as decimal(18,2)) AS `TI_AUXTIME12`,cast(`_subFinal`.`TI_AUXTIME13` as decimal(18,2)) AS `TI_AUXTIME13`,cast(`_subFinal`.`TI_AUXTIME14` as decimal(18,2)) AS `TI_AUXTIME14`,cast(`_subFinal`.`TI_AUXTIME15` as decimal(18,2)) AS `TI_AUXTIME15`,cast(`_subFinal`.`TI_AUXTIME16` as decimal(18,2)) AS `TI_AUXTIME16`,cast(`_subFinal`.`TI_AUXTIME17` as decimal(18,2)) AS `TI_AUXTIME17`,cast(`_subFinal`.`TI_AUXTIME18` as decimal(18,2)) AS `TI_AUXTIME18`,cast(`_subFinal`.`TI_AUXTIME19` as decimal(18,2)) AS `TI_AUXTIME19`,cast(`_subFinal`.`QUEUEDCALLS` as decimal(18,2)) AS `QUEUEDCALLS`,cast(`_subFinal`.`QUEUEDTIME` as decimal(18,2)) AS `QUEUEDTIME`,cast(`_subFinal`.`QUEUEDANSCALLS` as decimal(18,2)) AS `QUEUEDANSCALLS`,cast(`_subFinal`.`QUEUEDABNCALLS` as decimal(18,2)) AS `QUEUEDABNCALLS`,cast(`_subFinal`.`QUEUEDANSTIME` as decimal(18,2)) AS `QUEUEDANSTIME`,cast(`_subFinal`.`QUEUEDABNTIME` as decimal(18,2)) AS `QUEUEDABNTIME`,cast(`_subFinal`.`ABNTIME` as decimal(18,2)) AS `ABNTIME`,cast(`_subFinal`.`TRSINCALLS` as decimal(18,2)) AS `TRSINCALLS`,cast(`_subFinal`.`TRSOUTCALLS` as decimal(18,2)) AS `TRSOUTCALLS`,cast(`_subFinal`.`REJCALLS` as decimal(18,2)) AS `REJCALLS`,cast(`_subFinal`.`MAX_QUEUEDANSTIME` as decimal(18,2)) AS `MAX_QUEUEDANSTIME`,cast(`_subFinal`.`OUTCALLS` as decimal(18,2)) AS `OUTCALLS`,cast(`_subFinal`.`OUTTIME` as decimal(18,2)) AS `OUTTIME`,cast(`_subFinal`.`MAX_ABNTIME` as signed) AS `MAX_ABNTIME`,cast((case when (`_subFinal`.`QTD_AGENTES` < 1) then 0 else min(`_subFinal`.`QTD_AGENTES`) end) as signed) AS `MIN_AGENTES`,cast(`_subFinal`.`QTD_AGENTES` as signed) AS `MAX_AGENTES`,cast(`_subFinal`.`AVAILTIME` as decimal(18,2)) AS `AVAILTIME`,cast(0 as decimal(18,2)) AS `OTHERTIME`,cast(`_subFinal`.`TRBCALLS` as decimal(18,2)) AS `TRBCALLS`,cast(`_subFinal`.`ACDOFFER` as decimal(18,2)) AS `ACDOFFER` from `SOLUTIONS`.`_subFinal` where (concat_ws(' ',`_subFinal`.`calldate`,`_subFinal`.`COD_FAIXA_FAI`) <= (select now())) group by `_subFinal`.`calldate`,`_subFinal`.`COD_FAIXA_FAI`,cast(`_subFinal`.`COD_SERVICO` as signed) order by `_subFinal`.`calldate`,`_subFinal`.`COD_FAIXA_FAI`,cast(`_subFinal`.`COD_SERVICO` as signed);











